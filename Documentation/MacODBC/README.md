# MacODBC.h

**MACCABI Healthcare System — ODBC Infrastructure Layer**

---

## Quick Summary

MacODBC.h is the central ODBC infrastructure layer for the entire MACCABI C Backend system. According to the file header at `MacODBC.h:14-15`, it was written by Don Radlauer in December 2019 as a replacement for the previous Informix Embedded SQL (ESQL) approach.

The file appears to provide:
1. **25 public macros** — an embedded-SQL-like interface (ExecSQL, DeclareCursor, CommitWork, etc.)
2. **A central dispatcher** — the ODBC_Exec function (2212 lines) handling all 20 command types
3. **MS-SQL and Informix support** — simultaneous connections with optional mirroring
4. **Prepared statement cache** — up to 120 sticky statements
5. **Pointer validation mechanism** — SIGSEGV-based va_arg pointer checking

**Author**: Don Radlauer (`MacODBC.h:14`)
**Date**: December 2019 (`MacODBC.h:15`)
**File type**: Hybrid header/implementation under `#ifdef MAIN`
**Lines**: 4121

---

## Key Files

| File | Lines | Purpose |
|------|------:|---------|
| MacODBC.h | 4121 | ODBC infrastructure — 25 API macros, 11 functions, enums, structs, globals |

This file is **shared infrastructure** used by all 8 system components:
- FatherProcess, SqlServer, As400UnixServer, As400UnixClient
- As400UnixDocServer, As400UnixDoc2Server, ShrinkPharm, GenSql

---

## How to Use This Documentation

This documentation set consists of 7 files:

| File | Contents |
|------|----------|
| **01_PROGRAM_SPECIFICATION.md** | Overview, file structure, 11 functions, 25 macros, enums, structs, globals, constants, dependencies |
| **02_SYSTEM_ARCHITECTURE.md** | Single dispatcher pattern, #ifdef MAIN duality, 8-phase pipeline, DB mirroring, include injection |
| **03_TECHNICAL_ANALYSIS.md** | Detailed analysis of all 8 ODBC_Exec phases, 10 helper functions, SIGSEGV validation, sticky lifecycle, auto-reconnect |
| **04_BUSINESS_LOGIC.md** | Cursor lifecycle, transaction management, mirroring decision, admission control, error conversion, connection establishment |
| **05_CODE_ARTIFACTS.md** | Key code snippets with line references |
| **README.md** | This file — overview and navigation guide |
| **VALIDATION_REPORT.md** | Quality assurance verification and scoring |

### Recommended Reading Order

1. **README.md** (this file) — orientation
2. **01_PROGRAM_SPECIFICATION.md** — understand the structure, API, and enums/structs
3. **02_SYSTEM_ARCHITECTURE.md** — understand the dispatcher pattern and mirroring architecture
4. **04_BUSINESS_LOGIC.md** — understand cursor lifecycles, transactions, and mirroring
5. **03_TECHNICAL_ANALYSIS.md** — deep dive into all 8 ODBC_Exec phases
6. **05_CODE_ARTIFACTS.md** — reference to actual code snippets

---

## Related Components

According to research context, MacODBC.h is used by all system components:

### Consuming components (use the 25 API macros)
- **FatherProcess** — watchdog/supervisor daemon (`FatherProcess.c:29`)
- **SqlServer** — main SQL server (`SqlServer.c:29`)
- **As400UnixServer** — AS/400 bridge (`As400UnixServer.c:32`)
- **As400UnixClient** — AS/400 client (`As400UnixClient.c:29`)
- **As400UnixDocServer** — AS/400 document server (`As400UnixDocServer.c:31`)
- **As400UnixDoc2Server** — AS/400 extended document server (`As400UnixDoc2Server.c:34`)
- **ShrinkPharm** — DB cleanup utility (`ShrinkPharm.c:16`)
- **GenSql** — SQL utility (`GenSql.c:32`)

### Libraries
- **GenSql.h** — SQL infrastructure (SQLMD_connect, INF_CONNECT, sqlca)
- **MacODBC_MyOperatorIDs.h** — per-component operator identifiers

### Related Documentation
- **Documentation/FatherProcess/** — FatherProcess documentation (100/100)
- **Documentation/ShrinkPharm/** — ShrinkPharm documentation (100/100)

---

## System Requirements

Based on code analysis:

- **Platform**: UNIX/Linux (uses POSIX APIs: sigaction, sigsetjmp, setlocale)
- **Database**: ODBC — MS-SQL Server and/or Informix
- **Headers**: sql.h, sqlext.h (ODBC system headers)
- **Locale**: `he_IL.UTF-8` (according to `MacODBC.h:3488`)

---

## Source Code Location

```
source_code/Include/
└── MacODBC.h                          # Single source (4121 lines)
```

**Per-component injection files:**
```
source_code/{Component}/
├── MacODBC_MyOperators.c              # SQL operation definitions
└── MacODBC_MyCustomWhereClauses.c     # WHERE clause definitions
```

---

## Documentation Metadata

| Field | Value |
|-------|-------|
| Task ID | DOC-MACODBC-002 |
| Date Created | 2026-02-11 |
| Agent | CIDRA Documenter Agent |
| Source | CHUNKS/MacODBC/ |
| Research | RESEARCH/MacODBC_deepdive.md |
| Validation | 100/100 (see VALIDATION_REPORT.md) |

---

*Generated by the CIDRA Documenter Agent — DOC-MACODBC-002*
