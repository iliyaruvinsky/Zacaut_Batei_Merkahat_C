# FatherProcess

**מערכת בריאות מכבי - דימון מפקח/שומר**

---

## סיכום מהיר

FatherProcess הוא דימון המפקח המרכזי עבור מערכת הבריאות של מכבי. על פי קוד המקור ב-`FatherProcess.c:7-10`, הוא אחראי על "הפעלת מערכת מכבי ושמירה על כל השרתים פעילים."

התוכנית מבצעת את הפונקציות העיקריות הבאות:
1. **מאתחלת משאבי מערכת** - יוצרת סמפורים, זיכרון משותף וטבלאות
2. **מפעילה תהליכי בן** - מפעילה תוכניות שרת מוגדרות מפרמטרי מסד נתונים
3. **מנטרת תהליכי בן** - לולאת שמירה מזהה כשלים ומפעילה תהליכים מחדש
4. **מטפלת בפקודות IPC** - מקבלת הודעות בקרה לניהול מערכת
5. **מנהלת כיבוי מסודר** - מסיימת את כל הילדים בסדר מסודר

נכתב על ידי Ely Levy (רשומה) ב-1996, התוכנית תוחזקה ועודכנה עד 2024.

---

## קבצים מרכזיים

| קובץ | שורות | מטרה |
|------|------:|------|
| FatherProcess.c | 1972 | דימון שמירה ראשי - אתחול, ניטור, כיבוי |
| MacODBC_MyOperators.c | 114 | הגדרות סמני ODBC SQL עבור טבלת setup_new |
| MacODBC_MyCustomWhereClauses.c | 10 | פסוקיות WHERE מותאמות (קובץ stub) |
| Makefile | 44 | תצורת בנייה |

**סה"כ**: 2140 שורות ב-4 קבצים

---

## כיצד להשתמש בתיעוד זה

סט תיעוד זה מורכב מ-7 קבצים:

| קובץ | תכולה |
|------|--------|
| **01_PROGRAM_SPECIFICATION.md** | סקירה, מבנה קבצים, פונקציות, תלויות, הגדרות, גלובליים |
| **02_SYSTEM_ARCHITECTURE.md** | מודל תהליכים, רצף אתחול, מנגנוני IPC, מכונת מצבים, זרימת נתונים |
| **03_TECHNICAL_ANALYSIS.md** | ניתוח פונקציות מפורט, זרימת בקרה, טיפול בשגיאות, קריאות חיצוניות |
| **04_BUSINESS_LOGIC.md** | פיקוח על תהליכים, לוגיקת הפעלה מחדש, הקשר בריאותי, ניהול מרובי מופעים |
| **05_CODE_ARTIFACTS.md** | קטעי קוד מרכזיים עם הפניות שורה |
| **README.md** | קובץ זה - סקירה ומדריך ניווט |
| **VALIDATION_REPORT.md** | אימות הבטחת איכות וניקוד |

### סדר קריאה מומלץ

1. **README.md** (קובץ זה) - התמצאות
2. **01_PROGRAM_SPECIFICATION.md** - הבנת מבנה ורכיבים
3. **02_SYSTEM_ARCHITECTURE.md** - הבנת אופן פעולת המערכת
4. **04_BUSINESS_LOGIC.md** - הבנת פיקוח והתנהגות הפעלה מחדש
5. **03_TECHNICAL_ANALYSIS.md** - צלילה עמוקה לפרטי פונקציות
6. **05_CODE_ARTIFACTS.md** - הפניה לקטעי קוד בפועל

---

## רכיבים קשורים

על פי הקשר המחקר, FatherProcess מתקשר עם:

### תהליכי בן (מופעלים על ידי FatherProcess)
- **SqlServer** - worker שרת SQL (SQLPROC_TYPE)
- **As400UnixServer** - גשר AS/400 (AS400TOUNIX_TYPE)
- **DocSqlServer** - שרת SQL רופאים (DOCSQLPROC_TYPE)
- **PurchaseHistoryServer** - היסטוריית רכישות (PURCHASE_HIST_TYPE)
- תוכניות מוגדרות אחרות מטבלת מסד הנתונים `setup_new`

### ספריות
- **GenLib** - זיכרון משותף, סמפורים, הפעלת תהליכים, IPC סוקטים
- **GenSql** - קישוריות מסד נתונים, סכמת טבלאות (TableTab[])

### קבצי כותרת (דרך MacODBC.h)
- **Global.h** - קבועי מערכת, מבני נתונים, סוגי תהליכים
- **MsgHndlr.h** - הגדרות טיפול בהודעות

---

## דרישות מערכת

על בסיס ניתוח הקוד:

- **פלטפורמה**: UNIX/Linux (משתמש ב-POSIX APIs: fork, sigaction, shmget וכו')
- **מסד נתונים**: תואם ODBC (MS-SQL או Informix)
- **בנייה**: מהדר C עם ספריית ODBC (`-lodbc`)

---

## תצורה

FatherProcess מוגדר דרך:

1. **משתני סביבה**:
   - `MAC_SYS` - קובע אילו תת-מערכות להפעיל (pharm, doctor, doc_tcp_only)

2. **טבלת מסד נתונים** (`setup_new`):
   - הגדרות תוכניות (Program...)
   - הקצאות מערכת (פרמטר system)
   - הגדרות בקרת מופעים (startup_instances, max_instances וכו')
   - פרמטרי זמן ריצה

---

## הערות אבטחה

על פי הקשר המחקר (`RESEARCH/context_summary.md`):

- קיימים ערכים סודיים מקודדים קשיחות ב-`TikrotRPC.h` ו-`global_1.h`
- מיקומים אלה מתועדים אך הערכים אינם מועתקים לתיעוד
- הרשאות מאוחסנות בזיכרון משותף (`All.mac_user`, `All.mac_pass` וכו')

---

## מיקום קוד מקור

```
source_code/FatherProcess/
├── FatherProcess.c                  # מקור ראשי (1972 שורות)
├── MacODBC_MyOperators.c            # סמני SQL (114 שורות)
├── MacODBC_MyCustomWhereClauses.c   # פסוקיות WHERE (10 שורות)
├── Makefile                         # תצורת בנייה (44 שורות)
└── [קבצי פרויקט]                     # Visual Studio, תצורות Eclipse
```

---

## מטאדטה של תיעוד

| שדה | ערך |
|-----|-----|
| מזהה משימה | DOC-FATHER-001 |
| תאריך יצירה | 2026-02-02 |
| סוכן | סוכן המתעד של CIDRA |
| מקור | CHUNKS/FatherProcess/ |
| אימות | 100/100 (ראה VALIDATION_REPORT.md) |

---

*נוצר על ידי סוכן המתעד של CIDRA - DOC-FATHER-001*
