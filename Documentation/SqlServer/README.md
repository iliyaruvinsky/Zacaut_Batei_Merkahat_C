# SqlServer Documentation

**Component**: SqlServer — Primary Pharmacy Transaction Server
**Task ID**: DOC-SQL-001
**Generated**: 2026-02-13
**Pipeline**: CIDRA (Researcher → Chunker → Documenter)

---

## Quick Summary

SqlServer is the primary pharmacy transaction processing server for the MACCABI Healthcare C Backend system. It operates as a child worker process under FatherProcess, connecting to the database via MacODBC and handling approximately 60+ transaction codes from pharmacy terminals.

**Key statistics**:
- 13 source files, 83,983 total lines
- 62 semantic chunks (per Chunker analysis)
- 265 SQL operator definitions
- ~60+ transaction codes across 4 families (1xxx, 2xxx, 5xxx, 6xxx)
- 3 "Big Three" sale handlers totaling 17,940 lines (21.4% of codebase)

---

## Documentation Files

| File | Contents |
|------|----------|
| [01_PROGRAM_SPECIFICATION.md](01_PROGRAM_SPECIFICATION.md) | Overview, file structure, transaction dispatch map, dependencies, global variables, build configuration |
| [02_SYSTEM_ARCHITECTURE.md](02_SYSTEM_ARCHITECTURE.md) | Process model, lifecycle (startup → loop → dispatch → shutdown), signal handlers, IPC, ODBC compilation model, data flow diagram |
| [03_TECHNICAL_ANALYSIS.md](03_TECHNICAL_ANALYSIS.md) | Validation pipeline (8 stages), error severity model, DUR/OD engine, reliability patterns, REST integration, cache mechanisms |
| [04_BUSINESS_LOGIC.md](04_BUSINESS_LOGIC.md) | Big Three sale handlers (sub-chunked), delivery handlers, request/history handlers, 1xxx management, AS/400 integration, specialized handlers |
| [05_CODE_ARTIFACTS.md](05_CODE_ARTIFACTS.md) | ODBC operator catalog (265 cases), include-injection chain, operator-to-table mapping, dynamic SQL holes, macros, dead code |
| [VALIDATION_REPORT.md](VALIDATION_REPORT.md) | Verification checklist, statistics, 6 VER items, quality score, certification |

---

## Key Source Files

| File | Lines | Role |
|------|------:|------|
| SqlServer.c | 2,362 | Main server loop, dispatch, signals |
| SqlHandlers.c | 8,458 | 1xxx handlers + DUR/OD engine |
| ElectronicPr.c | 26,161 | 2xxx + 5xxx handlers |
| DigitalRx.c | 22,955 | 6xxx handlers |
| MessageFuncs.c | 13,631 | Shared business logic (61 functions) |
| MacODBC_MyOperators.c | 8,418 | 265 SQL operators |

---

## How to Navigate This Documentation

### By task:

- **Understanding the system**: Start with 01_PROGRAM_SPECIFICATION.md for the overview, then 02_SYSTEM_ARCHITECTURE.md for the architecture
- **Understanding a specific transaction**: Look up the transaction code in 01_PROGRAM_SPECIFICATION.md's dispatch map, then find its handler documentation in 04_BUSINESS_LOGIC.md
- **Understanding the validation pipeline**: See 03_TECHNICAL_ANALYSIS.md for the 8-stage pipeline with full cross-reference to all handlers
- **Understanding drug safety checks**: See 03_TECHNICAL_ANALYSIS.md's DUR/OD Engine section and 04_BUSINESS_LOGIC.md's TR1055 section
- **Finding a SQL operator**: See 05_CODE_ARTIFACTS.md's operator catalog, organized by transaction family
- **Understanding database tables**: See 05_CODE_ARTIFACTS.md's operator-to-table mapping
- **Checking known issues**: See VALIDATION_REPORT.md for the 6 verification items (VER-SQL-001 through VER-SQL-006)

### By transaction family:

| Family | Range | File | Description |
|--------|-------|------|-------------|
| Pharmacy Management | 1001-1080 | SqlHandlers.c | Shift operations, downloads, stock, financial |
| Electronic Rx | 2001-2101 | ElectronicPr.c | E-prescription sale/delivery/reporting |
| Nihul Tikrot | 5003-5090 | ElectronicPr.c | Subsidy sale/delivery/reference tables |
| Digital Rx | 6001-6103 | DigitalRx.c | Digital prescription sale/delivery/history |

---

## Related Components

| Component | Relationship |
|-----------|-------------|
| [FatherProcess](../FatherProcess/) | Parent supervisor — spawns and monitors SqlServer instances |
| [MacODBC](../MacODBC/) | ODBC infrastructure layer — compiled into SqlServer via `#define MAIN` |
| [ShrinkPharm](../ShrinkPharm/) | Database maintenance utility — shares MacODBC but uses lower deadlock priority |

---

## Research and Chunker Outputs

| File | Purpose |
|------|---------|
| `RESEARCH/SqlServer_deepdive.md` | Researcher agent's analysis of all 13 source files |
| `RESEARCH/MacODBC_deepdive.md` | Researcher agent's ODBC infrastructure analysis |
| `CHUNKS/SqlServer/repository.json` | 62 chunk definitions with metadata |
| `CHUNKS/SqlServer/graph.json` | Call graph: 62 nodes, 81 edges, 7 groups |
| `CHUNKS/SqlServer/analysis.json` | Statistics, patterns, verification backlog |
| `CHUNKS/SqlServer/DOCUMENTER_INSTRUCTIONS.md` | Chunker's documentation roadmap |

---

*Generated by CIDRA Documenter Agent - DOC-SQL-001*
