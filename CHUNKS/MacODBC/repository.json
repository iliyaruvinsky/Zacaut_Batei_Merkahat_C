{
  "metadata": {
    "project": "Zacaut_Batei_Merkahat_C",
    "component": "MacODBC",
    "file": "source_code/Include/MacODBC.h",
    "chunked_at": "2026-02-11T00:00:00Z",
    "total_chunks": 25,
    "total_lines": 4121,
    "language": "C",
    "strategy": "mixed_section_and_function_level",
    "author": "Don Radlauer",
    "author_date": "December 2019",
    "description": "ODBC infrastructure header/implementation — hybrid file replacing Informix embedded SQL (ESQL) with ODBC. Built around a single dispatcher (ODBC_Exec) called via 25 API wrapper macros. Supports simultaneous MS-SQL + Informix connections."
  },
  "chunks": [
    {
      "chunk_id": "ch_macodbc_001_header",
      "file": "MacODBC.h",
      "section": "header",
      "line_start": 1,
      "line_end": 44,
      "lines": 44,
      "token_count": 310,
      "summary": "File header block with purpose comment (Don Radlauer, Dec 2019), dual include guard (#pragma once + #ifndef), ODBC system includes (sql.h, sqlext.h), C stdlib includes (errno.h, locale.h, string.h, setjmp.h), project includes (GenSql.h, MacODBC_MyOperatorIDs.h), and extern declaration for caught_signal.",
      "tags": ["header", "include_guard", "includes", "odbc_headers"],
      "dependencies": ["/usr/local/include/sql.h", "/usr/local/include/sqlext.h", "errno.h", "locale.h", "string.h", "setjmp.h", "GenSql.h", "MacODBC_MyOperatorIDs.h"],
      "calls": [],
      "called_by": [],
      "cross_refs": ["ch_macodbc_003_enums", "ch_macodbc_020_getmainop"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_002_constants",
      "file": "MacODBC.h",
      "section": "constants",
      "line_start": 47,
      "line_end": 101,
      "lines": 55,
      "token_count": 390,
      "summary": "Core #define constants: MS-SQL preserve-cursor attributes (SQL_COPT_SS_PRESERVE_CURSORS=1204, SQL_PC_ON/OFF), Informix auto-free attribute (SQL_INFX_ATTR_AUTO_FREE=2263), pointer validation control flags (ENABLE_POINTER_VALIDATION=1, CHECK_VALIDITY_ONLY=0, CHECK_POINTER_IS_WRITABLE=1), prepared-state validation flag (ENABLE_PREPARED_STATE_VALIDATION=1), sticky statement limit (ODBC_MAX_STICKY_STATEMENTS=120), and parameter limit (ODBC_MAX_PARAMETERS=300).",
      "tags": ["constants", "defines", "sticky_statements", "pointer_validation", "configuration"],
      "dependencies": [],
      "calls": [],
      "called_by": ["ch_macodbc_010d_sticky", "ch_macodbc_010f_bind", "ch_macodbc_028_isvalidptr"],
      "cross_refs": ["ch_macodbc_010d_sticky", "ch_macodbc_010f_bind"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_003_enums",
      "file": "MacODBC.h",
      "section": "enums",
      "line_start": 104,
      "line_end": 151,
      "lines": 48,
      "token_count": 340,
      "summary": "Three enum definitions: ODBC_DatabaseProvider (ODBC_NoProvider, ODBC_Informix, ODBC_DB2, ODBC_MS_SqlServer, ODBC_Oracle) at 104-111; ODBC_CommandType (20 values: DECLARE_CURSOR through SET_CUSTOM_SIGSEGV_HANDLER) at 117-139; and tag_bool (false=0, true) typedef at 145-151 with BOOL_DEFINED guard.",
      "tags": ["enums", "database_provider", "command_type", "bool_typedef"],
      "dependencies": [],
      "calls": [],
      "called_by": ["ch_macodbc_010a_cmd_decode", "ch_macodbc_005_macros", "ch_macodbc_025_connect"],
      "cross_refs": ["ch_macodbc_005_macros", "ch_macodbc_010a_cmd_decode"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_004_structs_globals",
      "file": "MacODBC.h",
      "section": "structs_and_globals",
      "line_start": 153,
      "line_end": 273,
      "lines": 121,
      "token_count": 850,
      "summary": "Two struct typedefs (ODBC_DB_HEADER with Provider/Connected/HDBC/Name fields at 163; ODBC_ColumnParams with type/length fields at 164). Global variables under #ifdef MAIN (168-241): DB headers (MS_DB, INF_DB, MAIN_DB, ALT_DB), ODBC env handle, mirroring state (ODBC_MIRRORING_ENABLED, MIRROR_SQLCODE, MIRROR_ROWS_AFFECTED), connection config (LOCK_TIMEOUT, DEADLOCK_PRIORITY), pointer validation state (ODBC_ValidatingPointers, ODBC_PointerIsValid, sig_act_ODBC_SegFault, BeforePointerTest, AfterPointerTest), sticky arrays (StatementPrepared[], StatementOpened[], StatementIsSticky[] sized by ODBC_MAXIMUM_OPERATION), BoolType probe variable, and utility constants (IntZero/One/Two, ShortZero/One/Two, LongZero). Extern declarations for non-static globals under #else (242-273).",
      "tags": ["structs", "globals", "ifdef_main", "mirroring", "sticky_statements", "pointer_validation", "database_headers"],
      "dependencies": ["MacODBC_MyOperatorIDs.h"],
      "calls": [],
      "called_by": [],
      "cross_refs": ["ch_macodbc_010a_cmd_decode", "ch_macodbc_010d_sticky", "ch_macodbc_025_connect"],
      "complexity": "medium"
    },
    {
      "chunk_id": "ch_macodbc_005_macros",
      "file": "MacODBC.h",
      "section": "macro_api",
      "line_start": 276,
      "line_end": 336,
      "lines": 61,
      "token_count": 430,
      "summary": "Public macro API: SQL_WORKED(R) and SQL_FAILED(R) utility macros at 277-278; 25 ODBC_Exec wrapper macros at 311-335 organized by category: cursor lifecycle (DeclareCursor, DeclareCursorInto, DeclareAndOpenCursor, DeclareAndOpenCursorInto, DeclareDeferredCursor, DeclareDeferredCursorInto, OpenCursor, OpenCursorUsing, FetchCursor, FetchCursorInto, CloseCursor, FreeStatement), SQL execution (ExecSQL, ExecSql — duplicate spelling), transaction (CommitWork, RollbackWork, RollBackWork, CommitAllWork, RollbackAllWork, RollBackAllWork), isolation (SetDirtyRead, SetCommittedRead, SetRepeatableRead), utility (GetLengthsRead, SetCustomSegmentationFaultHandler). All route to ODBC_Exec with appropriate CommandType enum.",
      "tags": ["macros", "api", "cursor_management", "transaction", "isolation", "public_interface"],
      "dependencies": [],
      "calls": ["ODBC_Exec"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_010a_cmd_decode", "ch_macodbc_003_enums"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_007_error_enum",
      "file": "MacODBC.h",
      "section": "error_enum_and_macros",
      "line_start": 338,
      "line_end": 348,
      "lines": 11,
      "token_count": 120,
      "summary": "ODBC_ErrorCategory enum (ODBC_ENVIRONMENT_ERR, ODBC_DB_HANDLE_ERR, ODBC_STATEMENT_ERR) at 339-344 and three error-handler wrapper macros (ODBC_EnvironmentError, ODBC_DB_ConnectionError, ODBC_StatementError) at 346-348, each routing to ODBC_ErrorHandler with the appropriate category.",
      "tags": ["enums", "error_handling", "macros"],
      "dependencies": [],
      "calls": ["ODBC_ErrorHandler"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_027_errorhandler"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_006_declarations",
      "file": "MacODBC.h",
      "section": "function_declarations",
      "line_start": 351,
      "line_end": 420,
      "lines": 70,
      "token_count": 490,
      "summary": "Function prototypes for all 11 implemented functions: ODBC_Exec (352-356), SQL_GetMainOperationParameters (358-372), SQL_GetWhereClauseParameters (374-378), SQL_CustomizePerDB (381-383), ParseColumnList (385-387), find_FOR_UPDATE_or_GEN_VALUES (389-394), ODBC_CONNECT (396-401), CleanupODBC (403), ODBC_ErrorHandler (405-409), ODBC_IsValidPointer (411). Also macODBC_SegmentationFaultCatcher prototype (418) and static SIGSEGV_Handler function pointer defaulting to macODBC_SegmentationFaultCatcher (419).",
      "tags": ["declarations", "prototypes", "sigsegv", "function_pointers"],
      "dependencies": [],
      "calls": [],
      "called_by": [],
      "cross_refs": ["ch_macodbc_010a_cmd_decode", "ch_macodbc_029_segfaultcatcher"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_010a_cmd_decode",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "command_decode_and_init",
      "line_start": 422,
      "line_end": 772,
      "lines": 351,
      "token_count": 2460,
      "summary": "ODBC_Exec function entry: #ifdef MAIN guard (422), C-to-ODBC type chart comment (426-443), function signature with variadic args (446-450), local variable declarations including statement cache arrays (StatementCache, MirrorStatementCache, Statement_DB_Provider, etc. all sized by ODBC_MAXIMUM_OPERATION) (452-531), commented-out old init block (534-567), va_start + memset initialization of FieldLengthsRead and ColumnParameterPointers (569-583), ODBC_AvoidRecursion=1 (579), sqlerrd[2]=0 (582), statement pointer setup (588-589), command-type flag re-initialization (595-612), and the central command-type switch (634-763) mapping each ODBC_CommandType enum value to behavior flags (NeedToPrepare, NeedToExecute, NeedToFetch, etc.) and CurrentMacroName. Ends with OperationIdentifier validation (765-772).",
      "tags": ["odbc_exec", "command_dispatch", "switch_statement", "initialization", "variadic_args"],
      "dependencies": ["MacODBC_MyOperatorIDs.h"],
      "calls": ["GerrLogMini"],
      "called_by": ["DeclareCursor", "ExecSQL", "CommitWork", "all 25 wrapper macros"],
      "cross_refs": ["ch_macodbc_003_enums", "ch_macodbc_005_macros"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_010b_first_call",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "first_call_initialization",
      "line_start": 775,
      "line_end": 887,
      "lines": 113,
      "token_count": 790,
      "summary": "First-call initialization block (if ODBC_Exec_FirstTimeCalled at 780): memset of all statement cache arrays (791-801), counter/flag resets (803-811), SIGSEGV signal handler installation via sigaction using SIGSEGV_Handler function pointer (817-831) supporting both default and custom handlers, bool-size probe via sizeof(bool) to set BoolType for ODBC binding (836-845). After init block: activity counter for INS_messages_details (851-852), non-sticky statement diagnostic and forced FreeStatement for leaked prepared statements (866-874), ODBC_LastSQLStatementText initialization (880-883).",
      "tags": ["odbc_exec", "initialization", "signal_handling", "sigsegv", "bool_probe", "sticky_statements"],
      "dependencies": [],
      "calls": ["sigaction", "GerrLogMini", "FreeStatement"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_029_segfaultcatcher", "ch_macodbc_002_constants"],
      "complexity": "medium"
    },
    {
      "chunk_id": "ch_macodbc_010c_op_metadata",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "operation_metadata_loading",
      "line_start": 888,
      "line_end": 1072,
      "lines": 185,
      "token_count": 1300,
      "summary": "Master do-while(0) dummy loop start (888). If NeedToInterpretOp: calls SQL_GetMainOperationParameters (899-913) to load SQL text, column specs, stickiness, mirroring flag, and cursor name for the requested operation. Mirroring enable logic: CommandIsMirrored set only if ODBC_MIRRORING_ENABLED is true globally (918). Dynamic SQL text from va_arg if SQL_CommandText==NULL (953-964). Calls find_FOR_UPDATE_or_GEN_VALUES to detect INSERT/SELECT/FOR UPDATE/custom WHERE insertion point (975-980). Forces CommandIsMirrored=0 for SELECTs (994-996); computes MIRROR_DB as opposite of current Database (1002). Custom WHERE clause handling: reads WhereClauseIdentifier from va_arg (1021), calls SQL_GetWhereClauseParameters (1030-1034), optional dynamic WHERE text from va_arg (1053-1064).",
      "tags": ["odbc_exec", "operation_metadata", "mirroring", "dynamic_sql", "where_clause", "cross_reference_boundary"],
      "dependencies": ["MacODBC_MyOperators.c", "MacODBC_MyCustomWhereClauses.c"],
      "calls": ["SQL_GetMainOperationParameters", "find_FOR_UPDATE_or_GEN_VALUES", "SQL_GetWhereClauseParameters", "GerrLogMini"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_020_getmainop", "ch_macodbc_021_getwhere", "ch_macodbc_024_findforupdate"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_010d_sticky",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "sticky_statement_lifecycle",
      "line_start": 1075,
      "line_end": 1231,
      "lines": 157,
      "token_count": 1100,
      "summary": "Sticky statement lifecycle inside if(NeedToPrepare) block (1086). Inner do-while for preparation: DB provider switch handling — if provider changed from last use, frees old statement handle and mirror cache, decrements NumStickyHandlesUsed (1095-1131). Sticky admission control: if NumStickyHandlesUsed >= ODBC_MAX_STICKY_STATEMENTS (120), revokes stickiness with diagnostic (1145-1155); otherwise increments counter (1158). Prepared-state validation for already-prepared sticky statements: calls SQLNumParams when ENABLE_PREPARED_STATE_VALIDATION=1 (1182); on failure, frees handle and forces re-PREPARE (1195-1202). On success, breaks out of preparation (1206). Fresh statement allocation: SQLAllocStmt for primary DB (1213); if CommandIsMirrored, also allocates mirror statement on MIRROR_DB (1224).",
      "tags": ["odbc_exec", "sticky_statements", "prepared_statement_cache", "statement_allocation", "mirroring", "provider_switch"],
      "dependencies": [],
      "calls": ["SQLFreeHandle", "SQLNumParams", "SQLAllocStmt", "GerrLogMini"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_002_constants", "ch_macodbc_004_structs_globals"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_010e_sql_construct",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "sql_construction_and_prepare",
      "line_start": 1233,
      "line_end": 1447,
      "lines": 215,
      "token_count": 1510,
      "summary": "SQL command string construction: assembles SQL_CmdBuffer from base SQL_CommandText + optional WhereClauseText via sprintf (1269-1277) + optional auto-generated VALUES clause for INSERTs (1284-1295). Calls SQL_CustomizePerDB for provider-specific token rewriting ({FIRST}/{TOP}, {MODULO}, {TRANSACTION}, {GROUP}) (1300). FOR UPDATE cursor setup: SQLSetStmtAttr for concurrency locking + automatic FOR UPDATE append (1314-1336). SQLPrepare of the assembled SQL (1355); on failure: disconnects via SQLMD_disconnect, resets ODBC_Exec_FirstTimeCalled, returns DB_CONNECTION_BROKEN to trigger auto-reconnect (1377-1392). On success: sets StatementPrepared=1 (1398). Mirror PREPARE on alternate DB (1402-1417). SQLSetCursorName if CursorName != NULL (1421-1433). End of inner do-while for NeedToPrepare (1435-1436). ReturnCode break check (1440-1447).",
      "tags": ["odbc_exec", "sql_construction", "prepare", "mirroring", "auto_reconnect", "cursor_name", "for_update"],
      "dependencies": [],
      "calls": ["SQL_CustomizePerDB", "SQLPrepare", "SQLSetStmtAttr", "SQLSetCursorName", "ODBC_StatementError", "SQLMD_disconnect", "GerrLogMini"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_022_customizedb"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_010f_bind",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "pointer_validation_and_binding",
      "line_start": 1449,
      "line_end": 1976,
      "lines": 528,
      "token_count": 3700,
      "summary": "Phase 1 — Pointer collection with SIGSEGV validation (1449-1651): Sets ODBC_ValidatingPointers=1 (1456). Output column pointer loop: pulls va_arg pointers, skips optional WHERE clause ID and dynamic SQL text for FetchCursorInto (InterpretOutputOnly mode) (1479-1519), validates each via ODBC_IsValidPointer with CHECK_POINTER_IS_WRITABLE (1524), stores to ColumnParameterPointers array. Input column pointer loop: validates with CHECK_VALIDITY_ONLY (1560). Custom WHERE clause input pointer loop: validates (1595). Resets ODBC_ValidatingPointers (1618). END_OF_ARG_LIST sentinel check (1638-1649). Phase 2 — ODBC binding (1661-1976): Rewinds ColumnParameterCount (1667). SQLBindCol loop for output columns (1679-1781): type normalization (VARCHAR→CHAR, single-char→UTINYINT), bind-length calculation, FieldLengthsRead array. SQLBindParameter loop for input columns (1787-1896): C-to-SQL type mapping switch, over-length string truncation (1820-1835), mirror input binding. WHERE clause SQLBindParameter loop with NumInputColumns offset + mirror (1902-1975).",
      "tags": ["odbc_exec", "pointer_validation", "sigsegv", "parameter_binding", "sqlbindcol", "sqlbindparameter", "mirroring", "type_mapping"],
      "dependencies": [],
      "calls": ["ODBC_IsValidPointer", "SQLBindCol", "SQLBindParameter", "ODBC_StatementError", "SQLFreeHandle", "GerrLogMini"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_028_isvalidptr", "ch_macodbc_002_constants"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_010g_execute",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "execute_mirror_fetch",
      "line_start": 1978,
      "line_end": 2288,
      "lines": 311,
      "token_count": 2180,
      "summary": "Execute section (NeedToExecute, 1981): Pre-execute validation — returns DB_CONNECTION_BROKEN if Database->Connected==0 (1990-1993), returns -400 if !StatementPrepared (2002). Mirror execute: SQLExecute on MirrorStatementPtr first (2029), error switch for mirror (SQL_UNICODE_CONVERSION_FAILED treated as non-fatal, all others logged) (2047-2079), on success sets ALTERNATE_DB_USED=1 + SQLRowCount (2089-2094). Primary execute: SQLExecute on ThisStatementPtr (2100), error handling switch for sticky statements — known contention/reconnect errors treated as normal (INF_NOT_UNIQUE_INDEX, SQL_DEADLOCK, SQL_TRN_CLOSED_BY_OTHER_SESSION, DB_TCP_PROVIDER_ERROR, TABLE_SCHEMA_CHANGED, etc.) (2133-2183), on success: StatementOpened=1 (2206), SQLRowCount (2212-2213), negative rows-affected correction (2232-2240), MS-SQL silent INSERT failure detection (2252-2261). Mirror result merging: uses lower of two rows-affected, swaps in MIRROR_SQLCODE if non-zero (2266-2284). Fetch section (NeedToFetch, 2302): SQLFetchScroll SQL_FETCH_NEXT (2328), Convert_NF_to_zero logic (2333-2337), fetch error handling with sticky cleanup (2340-2372), cardinality check via second SQLFetchScroll (2385-2392).",
      "tags": ["odbc_exec", "execute", "mirroring", "fetch", "row_count", "silent_insert_failure", "auto_reconnect", "cardinality_check", "error_handling"],
      "dependencies": [],
      "calls": ["SQLExecute", "SQLRowCount", "SQLFetchScroll", "ODBC_StatementError", "SQLFreeHandle", "GerrLogMini"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_027_errorhandler"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_010h_txn_close",
      "file": "MacODBC.h",
      "function": "ODBC_Exec",
      "section": "transaction_isolation_close_return",
      "line_start": 2290,
      "line_end": 2657,
      "lines": 368,
      "token_count": 2580,
      "summary": "Transaction handling: NeedToCommit (2396-2446) — CommitAllWork: if ALTERNATE_DB_USED then SQLEndTran at ENV level, else at DBC level for MAIN_DB only (optimization); single-DB CommitWork: SQLEndTran at DBC level, clears ALTERNATE_DB_USED if not MAIN_DB. NeedToRollBack (2449-2490) — similar ENV-vs-DBC logic without the ALTERNATE_DB_USED optimization. Isolation level setting (2493-2529): SetDirtyRead/SetCommittedRead/SetRepeatableRead via SQLSetConnectAttr (skipped for Informix). End of master do-while(0) (2531). SQLCODE assignment: maps ReturnCode=1 to 0 (2536). Close section (2539-2606): sticky statements get SQLCloseCursor soft close + mirror close (2590-2597); non-sticky statements get NeedToFreeStatement=1 (2604). Free section (2609-2639): SQLFreeHandle + mirror free, sticky counter decrement, StatementPrepared/Opened reset. Cleanup (2642-2657): va_end, ColumnOutputLengths assignment, LengthReadArrayPtr_in output, ODBC_AvoidRecursion=0, ODBC_ValidatingPointers=0, return SQLCODE.",
      "tags": ["odbc_exec", "transaction", "commit", "rollback", "isolation_level", "cursor_close", "statement_free", "cleanup", "mirroring"],
      "dependencies": [],
      "calls": ["SQLEndTran", "SQLSetConnectAttr", "SQLCloseCursor", "SQLFreeHandle", "ODBC_EnvironmentError", "ODBC_DB_ConnectionError", "GerrLogMini"],
      "called_by": [],
      "cross_refs": ["ch_macodbc_007_error_enum"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_020_getmainop",
      "file": "MacODBC.h",
      "function": "SQL_GetMainOperationParameters",
      "section": "helper_function",
      "line_start": 2661,
      "line_end": 2817,
      "lines": 157,
      "token_count": 1100,
      "summary": "Resolves an OperationIdentifier to its SQL metadata: command text, output/input column specs, stickiness, mirroring flag, cursor name, WHERE clause requirement, etc. Uses SameOpAsLastTime optimization to skip re-parsing on repeated calls (2713). Central switch at 2745 includes per-component #include \"MacODBC_MyOperators.c\" (2747) — CROSS-REFERENCE INJECTION BOUNDARY. Calls ParseColumnList for output and input column specs (2760, 2765). Validates Convert_NF_to_zero (only for single INT output) (2775-2778). Copies results to 14 output pointer parameters (2782-2812).",
      "tags": ["operation_metadata", "cross_reference_boundary", "include_injection", "column_spec_parsing"],
      "dependencies": ["MacODBC_MyOperators.c"],
      "calls": ["ParseColumnList", "GerrLogMini"],
      "called_by": ["ODBC_Exec", "ODBC_ErrorHandler"],
      "cross_refs": ["ch_macodbc_010c_op_metadata", "ch_macodbc_023_parsecols", "source_code/FatherProcess/MacODBC_MyOperators.c", "source_code/SqlServer/MacODBC_MyOperators.c", "source_code/As400UnixServer/MacODBC_MyOperators.c", "source_code/As400UnixClient/MacODBC_MyOperators.c", "source_code/As400UnixDocServer/MacODBC_MyOperators.c", "source_code/As400UnixDoc2Server/MacODBC_MyOperators.c", "source_code/ShrinkPharm/MacODBC_MyOperators.c", "source_code/GenSql/MacODBC_MyOperators.c"],
      "complexity": "medium"
    },
    {
      "chunk_id": "ch_macodbc_021_getwhere",
      "file": "MacODBC.h",
      "function": "SQL_GetWhereClauseParameters",
      "section": "helper_function",
      "line_start": 2821,
      "line_end": 2902,
      "lines": 82,
      "token_count": 580,
      "summary": "Resolves a WhereClauseIdentifier to its text and input column specs. Uses SameOpAsLastTime optimization (2843). Central switch at 2864 includes per-component #include \"MacODBC_MyCustomWhereClauses.c\" (2866) — CROSS-REFERENCE INJECTION BOUNDARY. Calls ParseColumnList for input columns (2879). Copies results to 4 output pointer parameters (2886-2898).",
      "tags": ["where_clause", "cross_reference_boundary", "include_injection", "column_spec_parsing"],
      "dependencies": ["MacODBC_MyCustomWhereClauses.c"],
      "calls": ["ParseColumnList", "GerrLogMini"],
      "called_by": ["ODBC_Exec"],
      "cross_refs": ["ch_macodbc_010c_op_metadata", "ch_macodbc_023_parsecols", "source_code/FatherProcess/MacODBC_MyCustomWhereClauses.c", "source_code/SqlServer/MacODBC_MyCustomWhereClauses.c", "source_code/As400UnixServer/MacODBC_MyCustomWhereClauses.c", "source_code/As400UnixClient/MacODBC_MyCustomWhereClauses.c", "source_code/ShrinkPharm/MacODBC_MyCustomWhereClauses.c"],
      "complexity": "medium"
    },
    {
      "chunk_id": "ch_macodbc_022_customizedb",
      "file": "MacODBC.h",
      "function": "SQL_CustomizePerDB",
      "section": "helper_function",
      "line_start": 2906,
      "line_end": 3136,
      "lines": 231,
      "token_count": 1620,
      "summary": "Provider-specific SQL token rewriting. Processes the SQL command buffer in-place with 4 substitution categories: (1) {MODULO}/{MOD} → Informix: MOD(A,B), MS-SQL: (A % B) using strtok_r parsing (2948-2986); (2) {TOP}/{FIRST} → Informix: FIRST, MS-SQL: TOP (2990-3019); (3) {TRANSACTION} → Informix: TRANSACTION, MS-SQL: quoted \"TRANSACTION\" for reserved-word escaping (3064-3093); (4) {GROUP} → Informix: GROUP, MS-SQL: quoted \"GROUP\" (3098-3127). Uses strcasestr for case-insensitive search (requires _GNU_SOURCE). Updates CommandLength_out if any substitutions were made (3130-3133). Commented-out {ROWID} support (3021-3055).",
      "tags": ["sql_customization", "provider_specific", "informix", "ms_sql", "token_rewriting", "reserved_words"],
      "dependencies": [],
      "calls": ["strcasestr", "strtok_r", "GerrLogMini"],
      "called_by": ["ODBC_Exec"],
      "cross_refs": ["ch_macodbc_010e_sql_construct"],
      "complexity": "medium"
    },
    {
      "chunk_id": "ch_macodbc_023_parsecols",
      "file": "MacODBC.h",
      "function": "ParseColumnList",
      "section": "helper_function",
      "line_start": 3140,
      "line_end": 3330,
      "lines": 191,
      "token_count": 1340,
      "summary": "Parses a text column-specification string (e.g. \"INT, CHAR(20), SHORT\") into an array of ODBC_ColumnParams structs. Uses strtok tokenizer with delimiters \" \\t,[]()\" (3147). Recognizes types: INT/INTEGER→SQL_C_SLONG, SHORT/SMALLINT→SQL_C_SSHORT, CHAR(n)→SQL_C_CHAR with length, VARCHAR(n)→SQL_VARCHAR, DOUBLE/FLOAT→SQL_C_DOUBLE, LONG/BIGINT→SQL_C_SBIGINT, BOOL/BOOLEAN→BoolType (runtime-probed), UNSIGNED→SQL_C_ULONG, USHORT→SQL_C_USHORT, REAL→SQL_C_FLOAT, SINGLE_CHAR/ONECHAR→SQL_C_CHAR length 0 (special single-char handling). Validates parsed count matches expected NumColumnsIn (3326-3327).",
      "tags": ["column_parsing", "type_mapping", "odbc_types", "tokenizer"],
      "dependencies": [],
      "calls": ["strtok", "strcasecmp", "atoi", "GerrLogMini"],
      "called_by": ["SQL_GetMainOperationParameters", "SQL_GetWhereClauseParameters"],
      "cross_refs": ["ch_macodbc_020_getmainop", "ch_macodbc_021_getwhere"],
      "complexity": "medium"
    },
    {
      "chunk_id": "ch_macodbc_024_findforupdate",
      "file": "MacODBC.h",
      "function": "find_FOR_UPDATE_or_GEN_VALUES",
      "section": "helper_function",
      "line_start": 3334,
      "line_end": 3439,
      "lines": 106,
      "token_count": 740,
      "summary": "Tokenizes an SQL command string to detect: whether it is an INSERT (first token check, 3377-3380), whether it is a SELECT (3382-3385), whether it contains a FOR UPDATE clause (3403-3416), and whether it has a custom WHERE clause insertion point (%s token, 3392-3393). Returns results via 4 output pointers. Handles NULL SQL_command_in safely (3359). Used by ODBC_Exec to determine auto VALUES generation, mirroring eligibility, and FOR UPDATE append.",
      "tags": ["sql_parsing", "for_update", "insert_detection", "select_detection", "where_clause_detection"],
      "dependencies": [],
      "calls": ["strtok", "strcasecmp", "strcmp"],
      "called_by": ["ODBC_Exec"],
      "cross_refs": ["ch_macodbc_010c_op_metadata"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_025_connect",
      "file": "MacODBC.h",
      "function": "ODBC_CONNECT",
      "section": "connection_management",
      "line_start": 3443,
      "line_end": 3794,
      "lines": 352,
      "token_count": 2460,
      "summary": "Database connection establishment. First-call init: initializes MS_DB (Provider=ODBC_MS_SqlServer) and INF_DB (Provider=ODBC_Informix) headers (3476-3482), setlocale for Hebrew (3488), SQLAllocEnv for ODBC environment (3494-3505). Connection: SQLAllocConnect (3513), configurable ConnectTimeout from timeout_str param (3525-3528), pre-connection SQLSetConnectAttr calls (login timeout, connection timeout, dirty read isolation) (3534-3536). MS-SQL preserve-cursors: conditional SQL_COPT_SS_PRESERVE_CURSORS (3542-3547). SQLConnect with DSN/username/password (3552). MS-SQL post-connect: USE <dbname> (3630-3656), SET LOCK_TIMEOUT (3670-3689), SET DEADLOCK_PRIORITY (3702-3721). All databases: AUTOCOMMIT off (3729), dirty-read isolation default (3742). Informix: disable AUTOFREE (3752-3761). Error paths call CleanupODBC. Returns NativeError.",
      "tags": ["connection", "odbc_connect", "ms_sql", "informix", "lock_timeout", "deadlock_priority", "preserve_cursors", "autocommit", "isolation_level"],
      "dependencies": ["GenSql.c"],
      "calls": ["SQLAllocEnv", "SQLAllocConnect", "SQLSetConnectAttr", "SQLConnect", "SQLAllocStmt", "SQLPrepare", "SQLExecute", "SQLFreeStmt", "SQLGetConnectAttr", "CleanupODBC", "ODBC_EnvironmentError", "ODBC_DB_ConnectionError", "ODBC_StatementError", "setlocale", "GerrLogMini"],
      "called_by": ["GenSql.c:INF_CONNECT"],
      "cross_refs": ["ch_macodbc_026_cleanup", "ch_macodbc_004_structs_globals"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_026_cleanup",
      "file": "MacODBC.h",
      "function": "CleanupODBC",
      "section": "connection_management",
      "line_start": 3798,
      "line_end": 3819,
      "lines": 22,
      "token_count": 155,
      "summary": "Disconnects from a single database: SQLDisconnect + SQLFreeConnect, sets Connected=0. Decrements NUM_ODBC_DBS_CONNECTED; if last DB disconnected, also calls SQLFreeEnv to release the ODBC environment handle and resets ODBC_henv_allocated (3812-3814).",
      "tags": ["cleanup", "disconnect", "connection_management"],
      "dependencies": [],
      "calls": ["SQLDisconnect", "SQLFreeConnect", "SQLFreeEnv"],
      "called_by": ["ODBC_CONNECT", "SQLMD_disconnect"],
      "cross_refs": ["ch_macodbc_025_connect"],
      "complexity": "low"
    },
    {
      "chunk_id": "ch_macodbc_027_errorhandler",
      "file": "MacODBC.h",
      "function": "ODBC_ErrorHandler",
      "section": "error_handling",
      "line_start": 3823,
      "line_end": 4004,
      "lines": 182,
      "token_count": 1280,
      "summary": "Centralized ODBC error handler. Dispatches on ErrorCategory enum: ENVIRONMENT_ERR → SQLGetDiagRec on ENV handle (3847), DB_HANDLE_ERR → SQLGetDiagRec on DBC handle (3853), STATEMENT_ERR → calls SQL_GetMainOperationParameters to retrieve original SQL text (3867-3881), then SQLGetDiagRec on STMT handle (3884). Synthetic access-conflict conversion: native errors -11103/S1002, -11031, -211 are force-converted to SQLERR_CANNOT_POSITION_WITHIN_TABL (-243) to trigger automatic retry; frees sticky statement handle and decrements counter (3903-3926). Auto-reconnect conversion: SQL_TRN_CLOSED_BY_OTHER_SESSION, DB_TCP_PROVIDER_ERROR, TABLE_SCHEMA_CHANGED, DB_CONNECTION_BROKEN → calls SQLMD_disconnect, resets ODBC_Exec_FirstTimeCalled, converts to DB_CONNECTION_BROKEN (3936-3959). Formats error into ODBC_ErrorBuffer and sqlca.sqlerrm (3989-3995). Returns ODBC_NativeError.",
      "tags": ["error_handling", "auto_reconnect", "synthetic_error", "access_conflict", "connection_broken", "diagnostics"],
      "dependencies": [],
      "calls": ["SQLGetDiagRec", "SQL_GetMainOperationParameters", "SQLFreeHandle", "SQLMD_disconnect", "GerrLogMini"],
      "called_by": ["ODBC_EnvironmentError", "ODBC_DB_ConnectionError", "ODBC_StatementError"],
      "cross_refs": ["ch_macodbc_007_error_enum", "ch_macodbc_010g_execute"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_028_isvalidptr",
      "file": "MacODBC.h",
      "function": "ODBC_IsValidPointer",
      "section": "pointer_validation",
      "line_start": 4013,
      "line_end": 4070,
      "lines": 58,
      "token_count": 410,
      "summary": "Validates a pointer via SIGSEGV-based probing (guarded by ENABLE_POINTER_VALIDATION). Uses sigsetjmp/siglongjmp: saves state at BeforePointerTest (4027), attempts to read one byte from pointer (4032), then optionally writes it back if CheckPointerWritable_in is true (4041). If SIGSEGV fires during the probe, macODBC_SegmentationFaultCatcher sets ODBC_PointerIsValid=0 and siglongjmps back (handled in else branch, 4046-4052). Returns ODBC_PointerIsValid flag. Also sets ErrDesc_out to \"not readable\" or \"not writable\" for diagnostics (4063).",
      "tags": ["pointer_validation", "sigsegv", "sigsetjmp", "siglongjmp", "safety"],
      "dependencies": [],
      "calls": ["sigsetjmp"],
      "called_by": ["ODBC_Exec"],
      "cross_refs": ["ch_macodbc_029_segfaultcatcher", "ch_macodbc_010f_bind", "ch_macodbc_002_constants"],
      "complexity": "high"
    },
    {
      "chunk_id": "ch_macodbc_029_segfaultcatcher",
      "file": "MacODBC.h",
      "function": "macODBC_SegmentationFaultCatcher",
      "section": "pointer_validation",
      "line_start": 4073,
      "line_end": 4118,
      "lines": 46,
      "token_count": 325,
      "summary": "SIGSEGV signal handler. If ODBC_ValidatingPointers is true (pointer validation mode): sets ODBC_PointerIsValid=0, re-installs signal handler via sigaction, and siglongjmps back to BeforePointerTest (4086-4095). If ODBC_ValidatingPointers is false (normal execution): logs fatal segmentation fault, calls RollbackAllWork + SQLMD_disconnect, then ExitSonProcess with MAC_SERV_SHUT_DOWN or MAC_EXIT_SIGNAL (4099-4106). The #else branch (ENABLE_POINTER_VALIDATION=0) always does the fatal path (4108-4116). File ends with #endif MAIN (4120) and #endif MacODBC_H (4121).",
      "tags": ["sigsegv", "signal_handler", "pointer_validation", "fatal_error", "graceful_shutdown"],
      "dependencies": [],
      "calls": ["sigaction", "siglongjmp", "RollbackAllWork", "SQLMD_disconnect", "ExitSonProcess", "GerrLogMini"],
      "called_by": ["sigaction (installed as SIGSEGV handler)"],
      "cross_refs": ["ch_macodbc_028_isvalidptr", "ch_macodbc_010b_first_call"],
      "complexity": "medium"
    }
  ]
}
