{
  "metadata": {
    "component": "SqlServer",
    "generated_at": "2026-02-13T00:00:00Z",
    "description": "Dependency graph between all 62 chunks — edges represent calls, data flow, or cross-reference relationships across 13 source files."
  },
  "nodes": [
    { "id": "ch_sql_001_globals", "label": "Globals & Includes", "group": "main_server" },
    { "id": "ch_sql_002_startup", "label": "Startup Init (main)", "group": "main_server" },
    { "id": "ch_sql_003_dbconnect", "label": "DB Connect + Sysparams", "group": "main_server" },
    { "id": "ch_sql_004_mainloop", "label": "Steady-State Loop", "group": "main_server" },
    { "id": "ch_sql_005_dispatch_pre", "label": "Dispatch Preamble", "group": "main_server" },
    { "id": "ch_sql_006_dispatch_switch", "label": "Central Dispatch Switch", "group": "main_server" },
    { "id": "ch_sql_007_post_dispatch", "label": "Post-Dispatch", "group": "main_server" },
    { "id": "ch_sql_008_signal_handlers", "label": "Signal Handlers", "group": "main_server" },
    { "id": "ch_sql_009_cache_loaders", "label": "Cache Loaders", "group": "main_server" },
    { "id": "ch_sql_010_sqlhdl_header", "label": "SqlHandlers Header", "group": "handlers_1xxx" },
    { "id": "ch_sql_011_trn1001", "label": "TRN 1001 Open Shift", "group": "handlers_1xxx" },
    { "id": "ch_sql_012_trn1011_1014", "label": "TRN 1011/1013/1014", "group": "handlers_1xxx" },
    { "id": "ch_sql_013_trn1022_1028", "label": "TRN 1022/1026/1028", "group": "handlers_1xxx" },
    { "id": "ch_sql_014_trn1043_1051", "label": "TRN 1043-1051 Downloads", "group": "handlers_1xxx" },
    { "id": "ch_sql_015_trn1053_1055", "label": "TRN 1053/1055 DUR/OD", "group": "handlers_1xxx" },
    { "id": "ch_sql_016_trn1080_wrappers", "label": "TRN 1080 + Wrappers", "group": "handlers_1xxx" },
    { "id": "ch_sql_017_dur_od_engine", "label": "DUR/OD Engine", "group": "handlers_1xxx" },
    { "id": "ch_sql_020_epr_header", "label": "ElectronicPr Header", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_021_trn2001", "label": "TRN 2001 Rx List", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_022_trn2003", "label": "TRN 2003 E-Rx Sale", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_023_trn2005", "label": "TRN 2005 E-Rx Delivery", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_024_trn5003", "label": "TRN 5003 Subsidy Sale", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_025_trn5005", "label": "TRN 5005 Subsidy Delivery", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_026_trn2033_6033", "label": "TRN 2033/6033 Ishur", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_027_reftbl_2060_2068", "label": "TRN 2060-2068 Ref Tables", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_028_update_2070_2084", "label": "TRN 2070-2084 Updates", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_029_recon_2086_2101", "label": "TRN 2086-2101 Reconciliation", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_030_reftbl_5051_5061", "label": "TRN 5051-5061 Ref Tables", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_031_epr_utils", "label": "ElectronicPr Utilities", "group": "handlers_2xxx_5xxx" },
    { "id": "ch_sql_040_drx_header", "label": "DigitalRx Header", "group": "handlers_6xxx" },
    { "id": "ch_sql_041_trn6001_6101", "label": "TRN 6001/6101 Digital Rx", "group": "handlers_6xxx" },
    { "id": "ch_sql_042_trn6003", "label": "TRN 6003 Digital Sale", "group": "handlers_6xxx" },
    { "id": "ch_sql_043_trn6005_rt", "label": "TRN 6005 Delivery RT", "group": "handlers_6xxx" },
    { "id": "ch_sql_044_trn6005_spool", "label": "TRN 6005 Delivery Spool", "group": "handlers_6xxx" },
    { "id": "ch_sql_045_trn6011", "label": "TRN 6011 Drug History", "group": "handlers_6xxx" },
    { "id": "ch_sql_046_trn6102_6103", "label": "TRN 6102/6103 Virtual", "group": "handlers_6xxx" },
    { "id": "ch_sql_050_msgfn_header", "label": "MessageFuncs Header", "group": "business_logic" },
    { "id": "ch_sql_051_msg_parsing", "label": "Message Parsing", "group": "business_logic" },
    { "id": "ch_sql_052_tbl_error_infra", "label": "Table/Error Infrastructure", "group": "business_logic" },
    { "id": "ch_sql_053_pharmacy_auth", "label": "Pharmacy Auth", "group": "business_logic" },
    { "id": "ch_sql_054_drug_interaction", "label": "Drug Interaction", "group": "business_logic" },
    { "id": "ch_sql_055_special_presc", "label": "Special Prescription", "group": "business_logic" },
    { "id": "ch_sql_056_usage_limits", "label": "Usage & Purchase Limits", "group": "business_logic" },
    { "id": "ch_sql_057_ishur_special", "label": "Pharmacy Ishur", "group": "business_logic" },
    { "id": "ch_sql_058_doctor_pricing", "label": "Doctor-Drug Pricing", "group": "business_logic" },
    { "id": "ch_sql_059_health_alerts", "label": "Health Alerts Engine", "group": "business_logic" },
    { "id": "ch_sql_060_doctor_updates", "label": "Doctor Presc Updates", "group": "business_logic" },
    { "id": "ch_sql_061_member_services", "label": "Member Services", "group": "business_logic" },
    { "id": "ch_sql_062_rest_integration", "label": "REST Integration", "group": "business_logic" },
    { "id": "ch_sql_070_ops_header", "label": "Operators Header", "group": "odbc_operators" },
    { "id": "ch_sql_071_ops_general", "label": "General Operators", "group": "odbc_operators" },
    { "id": "ch_sql_072_ops_tr1xxx", "label": "TR1xxx Operators", "group": "odbc_operators" },
    { "id": "ch_sql_073_ops_tr2xxx", "label": "TR2xxx Operators", "group": "odbc_operators" },
    { "id": "ch_sql_074_ops_tr5xxx", "label": "TR5xxx Operators", "group": "odbc_operators" },
    { "id": "ch_sql_075_ops_tr6xxx", "label": "TR6xxx Operators", "group": "odbc_operators" },
    { "id": "ch_sql_080_socketapi_h", "label": "SocketAPI Header", "group": "infrastructure" },
    { "id": "ch_sql_081_socketapi_c", "label": "SocketAPI Impl", "group": "infrastructure" },
    { "id": "ch_sql_082_debugprint", "label": "DebugPrint", "group": "infrastructure" },
    { "id": "ch_sql_083_tikrotrpc", "label": "TikrotRPC", "group": "infrastructure" },
    { "id": "ch_sql_084_as400med_h", "label": "AS/400 Mediator Header", "group": "infrastructure" },
    { "id": "ch_sql_085_as400med_c", "label": "AS/400 Mediator Impl", "group": "infrastructure" },
    { "id": "ch_sql_086_customwhere", "label": "Custom WHERE Clauses", "group": "odbc_operators" }
  ],
  "edges": [
    { "from": "ch_sql_002_startup", "to": "ch_sql_003_dbconnect", "type": "calls", "label": "main() → DB connect + sysparams" },
    { "from": "ch_sql_003_dbconnect", "to": "ch_sql_009_cache_loaders", "type": "calls", "label": "init calls LoadPrescrSource, LoadTrnPermissions" },
    { "from": "ch_sql_003_dbconnect", "to": "ch_sql_083_tikrotrpc", "type": "calls", "label": "InitTikrotSP()" },
    { "from": "ch_sql_004_mainloop", "to": "ch_sql_005_dispatch_pre", "type": "calls", "label": "MakeAndSendReturnMessage()" },
    { "from": "ch_sql_004_mainloop", "to": "ch_sql_009_cache_loaders", "type": "calls", "label": "hourly refresh" },
    { "from": "ch_sql_004_mainloop", "to": "ch_sql_031_epr_utils", "type": "calls", "label": "process_spools()" },
    { "from": "ch_sql_005_dispatch_pre", "to": "ch_sql_006_dispatch_switch", "type": "calls", "label": "JSON parse → switch" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_007_post_dispatch", "type": "calls", "label": "post-dispatch cleanup" },

    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_011_trn1001", "type": "calls", "label": "case 1001" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_012_trn1011_1014", "type": "calls", "label": "case 1011/1013/1014" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_013_trn1022_1028", "type": "calls", "label": "case 1022/1026/1028" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_014_trn1043_1051", "type": "calls", "label": "case 1043-1051" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_015_trn1053_1055", "type": "calls", "label": "case 1053/1055" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_016_trn1080_wrappers", "type": "calls", "label": "case 1080" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_021_trn2001", "type": "calls", "label": "case 2001" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_022_trn2003", "type": "calls", "label": "case 2003" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_023_trn2005", "type": "calls", "label": "case 2005" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_024_trn5003", "type": "calls", "label": "case 5003" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_025_trn5005", "type": "calls", "label": "case 5005" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_026_trn2033_6033", "type": "calls", "label": "case 2033/6033" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_027_reftbl_2060_2068", "type": "calls", "label": "case 2060-2068" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_028_update_2070_2084", "type": "calls", "label": "case 2070-2084" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_029_recon_2086_2101", "type": "calls", "label": "case 2086-2101" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_030_reftbl_5051_5061", "type": "calls", "label": "case 5051-5061" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_041_trn6001_6101", "type": "calls", "label": "case 6001/6101" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_042_trn6003", "type": "calls", "label": "case 6003" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_043_trn6005_rt", "type": "calls", "label": "case 6005" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_045_trn6011", "type": "calls", "label": "case 6011" },
    { "from": "ch_sql_006_dispatch_switch", "to": "ch_sql_046_trn6102_6103", "type": "calls", "label": "case 6102/6103" },

    { "from": "ch_sql_022_trn2003", "to": "ch_sql_053_pharmacy_auth", "type": "calls", "label": "IS_PHARMACY_OPEN_X()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_055_special_presc", "type": "calls", "label": "test_special_prescription()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_056_usage_limits", "type": "calls", "label": "test_purchase_limits()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_017_dur_od_engine", "type": "calls", "label": "test_interaction_and_overdose()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_057_ishur_special", "type": "calls", "label": "test_pharmacy_ishur()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_058_doctor_pricing", "type": "calls", "label": "test_mac_doctor_drugs_electronic()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_059_health_alerts", "type": "calls", "label": "CheckHealthAlerts()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_060_doctor_updates", "type": "calls", "label": "update_doctor_presc()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_085_as400med_c", "type": "calls", "label": "as400EligibilityTest()" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_031_epr_utils", "type": "calls", "label": "read_member(), read_drug()" },

    { "from": "ch_sql_024_trn5003", "to": "ch_sql_053_pharmacy_auth", "type": "calls", "label": "IS_PHARMACY_OPEN_X()" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_055_special_presc", "type": "calls", "label": "test_special_prescription()" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_056_usage_limits", "type": "calls", "label": "test_purchase_limits()" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_017_dur_od_engine", "type": "calls", "label": "test_interaction_and_overdose()" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_059_health_alerts", "type": "calls", "label": "CheckHealthAlerts()" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_060_doctor_updates", "type": "calls", "label": "update_doctor_presc()" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_083_tikrotrpc", "type": "calls", "label": "CallTikrotSP()" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_085_as400med_c", "type": "calls", "label": "as400EligibilityTest()" },

    { "from": "ch_sql_042_trn6003", "to": "ch_sql_053_pharmacy_auth", "type": "calls", "label": "IS_PHARMACY_OPEN_X()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_055_special_presc", "type": "calls", "label": "test_special_prescription()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_056_usage_limits", "type": "calls", "label": "test_purchase_limits()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_017_dur_od_engine", "type": "calls", "label": "test_interaction_and_overdose()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_057_ishur_special", "type": "calls", "label": "test_pharmacy_ishur()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_058_doctor_pricing", "type": "calls", "label": "test_mac_doctor_drugs_electronic()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_059_health_alerts", "type": "calls", "label": "CheckHealthAlerts()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_060_doctor_updates", "type": "calls", "label": "update_doctor_presc()" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_085_as400med_c", "type": "calls", "label": "as400EligibilityTest()" },

    { "from": "ch_sql_041_trn6001_6101", "to": "ch_sql_053_pharmacy_auth", "type": "calls", "label": "IS_PHARMACY_OPEN_X()" },
    { "from": "ch_sql_041_trn6001_6101", "to": "ch_sql_055_special_presc", "type": "calls", "label": "test_special_prescription()" },
    { "from": "ch_sql_041_trn6001_6101", "to": "ch_sql_058_doctor_pricing", "type": "calls", "label": "predict_member_participation()" },
    { "from": "ch_sql_041_trn6001_6101", "to": "ch_sql_061_member_services", "type": "calls", "label": "find_preferred_drug(), SetMemberFlags()" },

    { "from": "ch_sql_023_trn2005", "to": "ch_sql_085_as400med_c", "type": "calls", "label": "as400SaveSaleRecord()" },
    { "from": "ch_sql_023_trn2005", "to": "ch_sql_060_doctor_updates", "type": "calls", "label": "update_doctor_presc()" },
    { "from": "ch_sql_043_trn6005_rt", "to": "ch_sql_085_as400med_c", "type": "calls", "label": "as400SaveSaleRecord()" },
    { "from": "ch_sql_043_trn6005_rt", "to": "ch_sql_060_doctor_updates", "type": "calls", "label": "update_doctor_presc()" },
    { "from": "ch_sql_044_trn6005_spool", "to": "ch_sql_060_doctor_updates", "type": "calls", "label": "update_doctor_presc()" },

    { "from": "ch_sql_017_dur_od_engine", "to": "ch_sql_054_drug_interaction", "type": "calls", "label": "IS_DRUG_INTERACAT(), get_drugs_in_blood()" },
    { "from": "ch_sql_011_trn1001", "to": "ch_sql_053_pharmacy_auth", "type": "calls", "label": "IS_PHARMACY_OPEN_X()" },
    { "from": "ch_sql_061_member_services", "to": "ch_sql_062_rest_integration", "type": "calls", "label": "EligibilityWithoutCard()" },
    { "from": "ch_sql_085_as400med_c", "to": "ch_sql_081_socketapi_c", "type": "calls", "label": "SocketCreate/Connect/Send/Receive" },

    { "from": "ch_sql_011_trn1001", "to": "ch_sql_072_ops_tr1xxx", "type": "data_flow", "label": "uses TR1001_* operators" },
    { "from": "ch_sql_022_trn2003", "to": "ch_sql_073_ops_tr2xxx", "type": "data_flow", "label": "uses TR2003_* operators" },
    { "from": "ch_sql_024_trn5003", "to": "ch_sql_074_ops_tr5xxx", "type": "data_flow", "label": "uses TR5003_* operators" },
    { "from": "ch_sql_042_trn6003", "to": "ch_sql_075_ops_tr6xxx", "type": "data_flow", "label": "uses TR6003_* operators" },
    { "from": "ch_sql_053_pharmacy_auth", "to": "ch_sql_071_ops_general", "type": "data_flow", "label": "uses IsPharmOpen_* operators" },
    { "from": "ch_sql_055_special_presc", "to": "ch_sql_071_ops_general", "type": "data_flow", "label": "uses TestSpecialPresc_* operators" },
    { "from": "ch_sql_059_health_alerts", "to": "ch_sql_071_ops_general", "type": "data_flow", "label": "uses CheckHealthAlerts_* operators" },
    { "from": "ch_sql_060_doctor_updates", "to": "ch_sql_071_ops_general", "type": "data_flow", "label": "uses UpdateDoctorPresc_* operators" },
    { "from": "ch_sql_009_cache_loaders", "to": "ch_sql_071_ops_general", "type": "data_flow", "label": "uses LoadPrescSourceCur, LoadTrnPermitCur" },
    { "from": "ch_sql_086_customwhere", "to": "ch_sql_071_ops_general", "type": "data_flow", "label": "WHERE fragments reference same operators" },

    { "from": "ch_sql_008_signal_handlers", "to": "ch_sql_001_globals", "type": "data_flow", "label": "reads/writes accept_sock, caught_signal" },
    { "from": "ch_sql_007_post_dispatch", "to": "ch_sql_081_socketapi_c", "type": "calls", "label": "WriteSocket/CloseSocket" }
  ],
  "groups": {
    "main_server": {
      "label": "SqlServer.c — Main Server Loop (2362 lines)",
      "description": "Process entry, initialization, steady-state loop, central dispatch switch, signal handlers, cache loaders"
    },
    "handlers_1xxx": {
      "label": "SqlHandlers.c — 1xxx Transaction Handlers (8458 lines)",
      "description": "Pharmacy management handlers: open/close shift, drug list, price list, stock entry, DUR/OD, contracts"
    },
    "handlers_2xxx_5xxx": {
      "label": "ElectronicPr.c — 2xxx/5xxx Transaction Handlers (26161 lines)",
      "description": "Electronic prescription and Nihul Tikrot subsidy handlers: drug list, sale, delivery, ishur, downloads"
    },
    "handlers_6xxx": {
      "label": "DigitalRx.c — 6xxx Transaction Handlers (22955 lines)",
      "description": "Digital prescription handlers: prescription request, sale, delivery, history, Chanut Virtualit"
    },
    "business_logic": {
      "label": "MessageFuncs.c — Business Logic Utilities (13631 lines)",
      "description": "Shared validation, pricing, interaction checking, health alerts, doctor prescription updates, REST services"
    },
    "odbc_operators": {
      "label": "MacODBC_MyOperators.c + CustomWhereClauses.c — SQL Operators (8692 lines)",
      "description": "Per-component SQL operation definitions injected into MacODBC.h via #include. 265 active + 4 commented-out operators"
    },
    "infrastructure": {
      "label": "Supporting Infrastructure (1567 lines)",
      "description": "TCP socket wrapper, debug logging, AS/400 DB2 RPC, AS/400 Meishar TCP client"
    }
  },
  "external_dependencies": [
    { "chunk": "ch_sql_001_globals", "file": "MacODBC.h", "type": "header_include", "description": "#define MAIN instantiates all MacODBC globals; compiles ODBC_Exec and all helpers into SqlServer" },
    { "chunk": "ch_sql_001_globals", "file": "MsgHndlr.h", "type": "header_include", "description": "#define MAIN instantiates ~70+ runtime sysparams globals" },
    { "chunk": "ch_sql_070_ops_header", "file": "GenSql_ODBC_Operators.c", "type": "include_injection", "line": 87, "description": "Shared GenSql operators injected before component-specific operators" },
    { "chunk": "ch_sql_071_ops_general", "file": "MacODBC.h", "type": "include_injection", "line": 2747, "description": "All operator cases injected into SQL_GetMainOperationParameters via #include" },
    { "chunk": "ch_sql_086_customwhere", "file": "MacODBC.h", "type": "include_injection", "line": 2866, "description": "All WHERE clause cases injected into SQL_GetWhereClauseParameters via #include" },
    { "chunk": "ch_sql_083_tikrotrpc", "file": "AS/400 DB2", "type": "external_rpc", "description": "Calls stored procedure RKPGMPRD.TIKROT on DB2 via ODBC" },
    { "chunk": "ch_sql_085_as400med_c", "file": "AS/400 Meishar", "type": "external_tcp", "description": "TCP client to AS/400 Meishar system on port 9400 for eligibility/sale records" },
    { "chunk": "ch_sql_062_rest_integration", "file": "REST services", "type": "external_http", "description": "CURL-based REST client for member ID translation and eligibility checks" },
    { "chunk": "ch_sql_002_startup", "file": "FatherProcess", "type": "called_from", "description": "SqlServer is spawned by FatherProcess supervisor via InitSonProcess(SQLPROC_TYPE)" }
  ]
}
